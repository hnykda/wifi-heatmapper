# Dockerfile.test - App container for integration tests
# Uses mocked WiFi commands (iw, nmcli) to simulate hardware

FROM node:22-alpine

WORKDIR /app

# Install system dependencies (iperf3 is real, iw/nmcli will be mocked)
RUN apk add --no-cache iperf3 wget

# Copy package files and install dependencies
COPY package*.json ./
RUN npm install

# Copy application files
COPY . .

# Copy mock commands and add to PATH (before /usr/bin)
COPY e2e/mock-commands /app/mock-commands
RUN chmod +x /app/mock-commands/*
ENV PATH="/app/mock-commands:${PATH}"

# Create data directories
RUN mkdir -p /app/data/surveys /app/public/media

# Expose port
EXPOSE 3000

# Run dev server
CMD ["npm", "run", "dev"]
